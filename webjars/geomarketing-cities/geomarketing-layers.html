<link rel="import" href="../polymer/polymer.html">
<!--<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">-->
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-menu/paper-submenu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<!--<link rel="import" href="../paper-input/paper-input.html">-->
<link rel="import" href="../paper-icon-item/paper-icon-item.html">
<link rel="import" href="../paper-tristate-checkbox/paper-tristate-checkbox.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../iron-icon/iron-icon.html">

<dom-module id="geomarketing-layers">
	<style>
		:host {
			display: block;
		}
        paper-item .iron-selected {
            color: lightblue;
			font-weight: normal;
        }
        paper-item[focused] {
            color: lightblue;
        }
        paper-icon-item[focused] {
            color: lightblue;
        }
        paper-icon-item[focused] iron-icon {
            color: blue;
        }
        paper-item[focused] {
            color: lightblue;
        }

        paper-menu {
        	display: block;
        }
	</style>
	<template>
		<paper-listbox id="ml" multi selected-values="{{selectedLayers}}" label="Слои" on-selected-items-changed="handleSelection">
			<paper-item value="ATMPOS" color="red"><i class="fa fa-check-square-o" aria-hidden="true"></i><iron-icon icon="maps:local-atm" item-icon style="fill:blue"></iron-icon>ATM/POS</paper-item>
			<paper-item value="VSP" color="green"><i class="fa fa-check-square-o" aria-hidden="true"></i><iron-icon icon="maps:local-atm" item-icon style="fill:green"></iron-icon>ВСП</paper-item>
			<paper-item value="MARKETRENT" color="orange"><i class="fa fa-check-square-o" aria-hidden="true"></i><iron-icon icon="home" item-icon style="fill:orange"></iron-icon>ЦИАН недвижимость</paper-item>
			<paper-item value="RENT" color="darkred"><i class="fa fa-square-o" aria-hidden="true"></i><iron-icon icon="home" item-icon style="fill:darkred"></iron-icon>АСУН</paper-item>
			<paper-item value="DUE" color="orange"><i class="fa fa-square-o" aria-hidden="true"></i><iron-icon icon="maps:local-atm" item-icon style="fill:orange"></iron-icon>Кредиты</paper-item>
			<paper-item value="OVERDUE" color="cadetblue"><i class="fa fa-square-o" aria-hidden="true"></i><iron-icon icon="maps:local-atm" item-icon style="fill:cadetblue"></iron-icon>Просроченные кредиты</paper-item>
			<paper-item value="GRID" color="darkgreen"><i class="fa fa-square-o" aria-hidden="true"></i><iron-icon icon="image:grid-on" item-icon style="fill:darkgreen"></iron-icon>Сетка</paper-item>
		</paper-listbox>
		<!--
		<iron-selector id="layers" multi attr-for-selected="name" selected-values="['ATMPOS','CIAN']" selected-attribute="checked">
			<paper-checkbox name="ATMPOS"><iron-icon icon="maps:local-atm" item-icon style="fill:red"></iron-icon>ATM/POS/ВСП</paper-checkbox><br>
			<paper-checkbox name="POS"><iron-icon icon="shopping-basket" item-icon style="fill:blue"></iron-icon>POS</paper-checkbox><br>
			<paper-checkbox name="VSP"><iron-icon icon="maps:local-atm" item-icon style="fill:green"></iron-icon>ВСП</paper-checkbox><br>
			<paper-checkbox name="CIAN"><iron-icon icon="home" item-icon style="fill:darkred"></iron-icon>ЦИАН</paper-checkbox><br>
			<paper-checkbox name="RENT"><iron-icon icon="shopping-basket" item-icon style="fill:orange"></iron-icon>АСУН</paper-checkbox><br>
			<paper-checkbox name="places"><iron-icon icon="shopping-basket" item-icon style="fill:cadetblue"></iron-icon>Places</paper-checkbox><br>
			<paper-checkbox name="DUE"><iron-icon icon="shopping-basket" item-icon style="fill:black"></iron-icon>Кредиты</paper-checkbox><br>
			<paper-checkbox name="OVERDUE"><iron-icon icon="maps:local-atm" item-icon style="fill:cadetblue"></iron-icon>Просроченные кредиты</paper-checkbox><br>
			<paper-checkbox name="GRID"><iron-icon icon="editor:border-all" item-icon style="fill:purple"></iron-icon>Сетка</paper-checkbox><br>
		</iron-selector>
		<span>[[foo]]</span>

				<paper-listbox id="layers-control" selected-values="{{selectedLayers}}" multi>
					<paper-icon-item item-name="atmpos">
						<div class="custom-awesome-marker awesome-marker-icon-red">
							<i class="icon icon-credit-card icon-white"></i>
						</div>
						<iron-icon icon="maps:local-atm" item-icon></iron-icon>
						<paper-item value="atmpos">ATM/POS</paper-item>
					</paper-icon-item>
					<paper-icon-item item-name="cian">
						<div class="custom-awesome-marker awesome-marker-icon-blue">
							<i class="icon icon-credit-card icon-white"></i>
						</div>
						<iron-icon icon="build" item-icon></iron-icon>
						<paper-item value="cian">ЦИАН недвижимость</paper-item>
					</paper-icon-item>
					<paper-icon-item item-name="asun">
						<div class="custom-awesome-marker awesome-marker-icon-green">
							<i class="icon icon-credit-card icon-white"></i>
						</div>
						<iron-icon icon="shopping-basket" item-icon></iron-icon>
						<paper-item value="asun">АСУН</paper-item>
					</paper-icon-item>
					<paper-icon-item item-name="places">
						<div class="custom-awesome-marker awesome-marker-icon-purple">
							<i class="icon icon-credit-card icon-white"></i>
						</div>
						<iron-icon icon="maps:my-location" item-icon></iron-icon>
						<paper-item value="places">Google Places</paper-item>
					</paper-icon-item>
					<paper-icon-item item-name="grid">
						<div class="custom-awesome-marker awesome-marker-icon-cadetblue">
							<i class="icon icon-credit-card icon-white"></i>
						</div>
						<iron-icon icon="image:grid-on" item-icon></iron-icon>
						<paper-item value="grid">Сетка</paper-item>
					</paper-icon-item>
				</paper-listbox>
				<span>[[selectedLayers]]</span>
		-->
	</template>
	<script>
		Polymer({
			is: 'geomarketing-layers'
			, properties: {
				selectedLayers: {
					type: Array
					, value: []
				}
			}
			, ready: function() {
				this.set("selectedLayers", [...globals.activeMarkerSet]);
				console.log("selectedLayers", this.get("selectedLayers"));
				$(Polymer.dom(this.root).querySelectorAll("paper-item")).each(function(item, value) {
					var layer= $(this).attr("value");
					if(globals.activeMarkerSet.has(layer)) {
						$(this).attr("aria-selected", "true");
						$(this).addClass("iron-selected");
						$("i", this).removeClass("fa-square-o").addClass("fa-check-square-o");
					} else {
						$(this).removeAttr("aria-selected")
						$(this).removeClass("iron-selected");
						$("i", this).removeClass("fa-check-square-o").addClass("fa-square-o");
					}
				});
			}
			, handleSelection: function(e) {
				var items= e.detail.value;	// выбранные слои
				console.log("items-changed", items);
				_.forEach(items, function(layer) {	//
					console.log($(layer).attr("value"), globals.activeMarkerSet.has(layer), $(layer).is(".iron-selected"), $(layer).attr("aria-selected"));
					var value= $(layer).attr("value");
					if(globals.activeMarkerSet.has(value)) {
						console.log("layer-deselected", value);
					} else {
						console.log("layer-selected", value);
					}
				});
				var that= this;
				$("#ml paper-item").each(function(item, value) {
					var layer= $(this).attr("value");
					var selected= $(this).attr("aria-selected");
					if(!!selected && !globals.activeMarkerSet.has(layer)) {
						console.log("layer-selected", layer);
						globals.activeMarkerSet.add(layer);
						$("i", this).removeClass("fa-check-square-o").addClass("fa-square-o");
						that.fire("layer-selected", layer);
					} else if(globals.activeMarkerSet.has(layer)) {
						console.log("layer-deselected", layer);
						globals.activeMarkerSet.delete(layer);
						$("i", this).removeClass("fa-square-o").addClass("fa-check-square-o");
						that.fire("layer-deselected", layer);
					} else {
						console.log("layer-?", layer);
					}
				});
				L.control.sidebar('sidebar').close();
			}
		});
	</script>
</dom-module>
