<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-input/paper-input.html">

<dom-module id="geomarketing-cities">
	<style>
		:host {
			display: block;
		}
	</style>
  	<template>
		<paper-dropdown-menu label="Город:" on-iron-select="handleSelect">
			<paper-listbox class="dropdown-content">
				<template is="dom-repeat" items="{{cities}}">
					<paper-item value="{{item.code}}" data-code="{{item.code}}" data-y="{{item.y}}" data-x="{{item.x}}"
						data-xmin="{{item.xmin}}" data-xmax="{{item.xmax}}" data-ymin="{{item.ymin}}" data-ymax="{{item.ymax}}"
					>{{item.text}}</paper-item>
				</template>
			</paper-listbox>
		</paper-dropdown-menu>
	</template>
	<script>
		Polymer({
			is: 'geomarketing-cities'
			, properties: {
				cities: {
					type: Array
					, value: []
				}
			}
			, ready: function() {
/*
				var that= this;
				$.getJSON("/json/cities").then(function(cities) {
					console.log("cities ", cities);
					return _.map(cities, function(value, index) {	// todo а оно надо? структура уже такая как хочется
						return {
							latName: value.latName
							, text: value.city
							, x: value.x
							, y:  value.y
							, xmin: value.xmin
							, xmax: value.xmax
							, ymin: value.ymin
							, ymax: value.ymax
							, code: value.code
						};
					});
				}).then(function(cities) {
					that.set("cities", cities);
				});
*/
			}
			, handleSelect: function(e) {
				console.log("city selected", $("#cities")[0].selectedItemLabel);
				var item= e.detail.item;
				var code= item.dataCode;
				var x= item.dataX; var y= item.dataY;
				var xmin= item.dataXmin; var ymin= item.dataYmin;
				var xmax= item.dataXmax; var ymax= item.dataYmax;
				this.fire("city-select", {'code': code, 'x': x, 'y': y, 'xmin': xmin, 'xmax': xmax, 'ymin': ymin, 'ymax': ymax});
			}
		});
	</script>
</dom-module>
